
<circuit access="public">

	<fuseaction name="about">
		<do action="v.about" contentvariable="content" />
		<do action="showPage" />
	</fuseaction>
	
	<fuseaction name="start">
		<do action="v.start" contentvariable="content" />
		<do action="showPage"  />
	</fuseaction>
	
	<fuseaction name="browseServer">		
		<invoke object="application.fso" methodcall="getTree(application.rootPathsList,application.isWindowsPlatform,attributes.refreshFolders)"  returnvariable="dtree"/> 	
		<do action="v.browseServer" />
	</fuseaction>
	
	<fuseaction name="generateDocBook">
		<do action="m.validateStartForm" />
		<if condition="hasErrors">
			<true>
				<!-- display the form with errors -->
				<do action="start" />
			</true>
			<false>	
				<!-- refresh the project directory -->
				<set name="projectDir" value="#application.fusebox.webrootdirectory#projects#application.directorySeparator##attributes.projectOutputDirectory#" /> 
				<invoke object="application.fso" methodcall="refreshDirectory(projectDir)" /> 
				<do action="m.generateDocBook" />
				<!-- customize the stylesheet -->
				<set name="originalStylesheet" value="#application.fusebox.webrootdirectory#xsl#application.directorySeparator#cfcdoc_template.xsl" />
				<set name="customStylesheet" value="#application.fusebox.webrootdirectory#projects#application.directorySeparator##attributes.projectOutputDirectory##application.directorySeparator#cfcdoc.xsl" />
				<do action="m.customizeStyleSheet" />
				<set name="destination" value="#application.fusebox.webrootdirectory#projects#application.directorySeparator##attributes.projectOutputDirectory##application.directorySeparator#cfcdoc.xml" />								
				<invoke object="application.cfcdoc" methodcall="saveDocBook(docbookxml=docbookxml,destination=destination)" returnvariable="result" />
				<set name="xslfile" value="#application.fusebox.webrootdirectory#projects#application.directorySeparator##attributes.projectOutputDirectory##application.directorySeparator#cfcdoc.xsl" />
				<set name="xmlfile" value="#application.fusebox.webrootdirectory#projects#application.directorySeparator##attributes.projectOutputDirectory##application.directorySeparator#cfcdoc.xml" />				
				<!-- transform the docbook to the html files  -->
				<invoke object="application.cfcdoc" methodcall="transformDocBook(xslfile=xslfile,xmlfile=xmlfile,licensekey=application.licensekey)" returnvariable="transformresult" />
				<!-- copy the css to the output directory -->
				<set name="cssfile" value="#application.fusebox.webrootdirectory#css#application.directorySeparator#cfcdoc.css" />				
				<invoke object="application.fso" methodcall="copyToDirectory(source=cssfile,destination=projectDir)" />
				<!-- copy the native.html file to the output directory -->
				<set name="nativetypesfile" value="#application.fusebox.webrootdirectory#views#application.directorySeparator#nativetypes.html" />
				<invoke object="application.fso" methodcall="copyToDirectory(source=nativetypesfile,destination=projectDir)" />
				<!-- copy the unknowncomponent.html file to the output directory -->
				<set name="unknowncomponentfile" value="#application.fusebox.webrootdirectory#views#application.directorySeparator#unknowncomponent.html" />
				<invoke object="application.fso" methodcall="copyToDirectory(source=unknowncomponentfile,destination=projectDir)" />
				<!-- generate files for eclipse -->
				<set name="attributes.htmlBasePath" value="#application.fusebox.webrootdirectory#projects#application.directorySeparator##attributes.projectOutputDirectory##application.directorySeparator##attributes.htmlOutputDirectory#" /> 
				<do action="m.generateEclipseTableOfContents" /> 
				<do action="m.generateFrames" /> 
				<!-- create the zipfile -->
				<set name="zipPath" value="#projectDir##application.directorySeparator##attributes.htmlOutputDirectory#.zip" /> 
				<invoke object="application.fso" methodcall="zipFileNew(zipPath=zipPath,toZip=attributes.htmlBasePath,relativeFrom=projectDir)" />
				<do action="m.getDocBook" />
				<do action="v.showDocBook" contentvariable="content" />
				<do action="showPage"  />
			</false>
		</if>
	</fuseaction>
	
	<fuseaction name="generatePDF">
		<set name="attributes.projectOutputDirectory" value="CFCDoc" />
		<set name="projectDir" value="#application.fusebox.webrootdirectory#projects#application.directorySeparator##attributes.projectOutputDirectory#" /> 
		<set name="xmlfile" value="#application.fusebox.webrootdirectory#projects#application.directorySeparator##attributes.projectOutputDirectory##application.directorySeparator#cfcdoc.xml" />				
		<set name="xmlfileforpdf" value="#application.fusebox.webrootdirectory#projects#application.directorySeparator##attributes.projectOutputDirectory##application.directorySeparator#cfcdoc_pdf.xml" />				
		<invoke object="application.cfcdoc" methodcall="createDocBookForPDF(xmlfile=xmlfile,destination=xmlfileforpdf)" returnvariable="fofilecontents" />		
		<set name="xslfile" value="#application.fusebox.webrootdirectory#xsl#application.directorySeparator#cfcdoc_fo_template.xsl" />		
		<set name="fofile" value="#application.fusebox.webrootdirectory#projects#application.directorySeparator##attributes.projectOutputDirectory##application.directorySeparator#cfcdoc.fo" />				
		<set name="pdffile" value="#application.fusebox.webrootdirectory#projects#application.directorySeparator##attributes.projectOutputDirectory##application.directorySeparator#cfcdoc.pdf" />				
		<set name="fo2pdflogfile" value="#application.fusebox.webrootdirectory#projects#application.directorySeparator##attributes.projectOutputDirectory##application.directorySeparator#cfcdoc_fo2pdf_log.txt" />								
		<invoke object="application.cfcdoc" methodcall="xml2fo(xslfile=xslfile,xmlfile=xmlfileforpdf,fofile=fofile,licensekey=application.licensekey)" returnvariable="fofilecontents" />		
		<invoke object="application.cfcdoc" methodcall="fo2pdf(fopExecutablePath=application.fopExecutablePath,fofile=fofile,pdffile=pdffile,logfile=fo2pdflogfile)" returnvariable="fo2pdfresults" />		
		<do action="v.createPDFComplete" contentvariable="content" />
		<do action="showPage"  />
	</fuseaction>
	
	<fuseaction name="help">
		<do action="v.help" contentvariable="content"/>
		<do action="showPage"  />
	</fuseaction>
	
	<fuseaction name="temp">
		<do action="v.showDocBook" contentvariable="content" />
		<do action="showPage"  />
	</fuseaction>
	
	<fuseaction name="showPage">
		<do action="v.mainLayout" />
	</fuseaction>

</circuit>